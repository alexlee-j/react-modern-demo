# useImperativeHandleï¼šè®©çˆ¶ç»„ä»¶æ§åˆ¶å­ç»„ä»¶çš„"é¥æ§å™¨" ğŸ®

## ä¸€ã€æœ€ç®€å•çš„ç†è§£ ğŸ¤”

æƒ³è±¡ä¸€ä¸‹ï¼ŒuseImperativeHandle å°±åƒæ˜¯ä¸€ä¸ªé¥æ§å™¨åˆ¶é€ å·¥å‚ï¼š
1. å­ç»„ä»¶åˆ¶é€ é¥æ§å™¨ï¼ˆå®šä¹‰æ–¹æ³•ï¼‰
2. çˆ¶ç»„ä»¶ä½¿ç”¨é¥æ§å™¨ï¼ˆè°ƒç”¨æ–¹æ³•ï¼‰

## äºŒã€ä»€ä¹ˆæ—¶å€™éœ€è¦å®ƒï¼ŸğŸ•’

### 1. é€‚åˆçš„åœºæ™¯ âœ…
- éœ€è¦çˆ¶ç»„ä»¶ç›´æ¥æ§åˆ¶å­ç»„ä»¶è¡Œä¸ºæ—¶
- å­ç»„ä»¶æœ‰ä¸€äº›å¤æ‚çš„å†…éƒ¨é€»è¾‘éœ€è¦æš´éœ²ç»™çˆ¶ç»„ä»¶æ—¶
- æƒ³è¦é™åˆ¶çˆ¶ç»„ä»¶èƒ½è®¿é—®çš„å­ç»„ä»¶æ–¹æ³•æ—¶

### 2. ä¸é€‚åˆçš„åœºæ™¯ âŒ
- åªæ˜¯ä¼ é€’æ•°æ®ï¼ˆç”¨ props å°±å¥½ï¼‰
- ç®€å•çš„çŠ¶æ€ç®¡ç†ï¼ˆç”¨ state æ›´åˆé€‚ï¼‰
- ç»„ä»¶é—´çš„æ™®é€šé€šä¿¡ï¼ˆç”¨ props + å›è°ƒå‡½æ•°ï¼‰

## ä¸‰ã€åŸºæœ¬ç”¨æ³• ğŸ“

### 1. æœ€ç®€å•çš„ä¾‹å­
```tsx
// 1. å®šä¹‰å­ç»„ä»¶çš„"é¥æ§å™¨"æŒ‰é’®
interface ChildHandle {
  sayHello: () => void;
}

// 2. åˆ¶é€ å¸¦é¥æ§å™¨çš„å­ç»„ä»¶
const Child = forwardRef<ChildHandle>((props, ref) => {
  // 3. å®šä¹‰é¥æ§å™¨æŒ‰é’®çš„åŠŸèƒ½
  useImperativeHandle(ref, () => ({
    sayHello: () => {
      console.log('ä½ å¥½ï¼');
    }
  }));

  return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>;
});

// 4. çˆ¶ç»„ä»¶ä½¿ç”¨é¥æ§å™¨
function Parent() {
  const childRef = useRef<ChildHandle>(null);
  
  return (
    <div>
      <Child ref={childRef} />
      <button onClick={() => childRef.current?.sayHello()}>
        è®©å­ç»„ä»¶è¯´ä½ å¥½
      </button>
    </div>
  );
}
```

## å››ã€è¿›é˜¶ä½¿ç”¨ ğŸš€

### 1. å¸¦ä¾èµ–çš„é¥æ§å™¨
```tsx
useImperativeHandle(
  ref,
  () => ({
    getData: () => data
  }),
  [data] // å½“ data å˜åŒ–æ—¶æ›´æ–°é¥æ§å™¨
);
```

### 2. ç»„åˆå¤šä¸ªåŠŸèƒ½
```tsx
useImperativeHandle(ref, () => ({
  // åŸºç¡€åŠŸèƒ½
  reset: () => { /* ... */ },
  
  // è·å–æ•°æ®
  getData: () => { /* ... */ },
  
  // æ›´æ–°ç•Œé¢
  update: () => { /* ... */ }
}));
```

## äº”ã€ä½¿ç”¨å»ºè®® ğŸ’¡

### 1. ä¿æŒç®€å•
- åªæš´éœ²å¿…è¦çš„æ–¹æ³•
- æ–¹æ³•åè¦æ¸…æ™°æ˜“æ‡‚
- é¿å…æš´éœ²å¤ªå¤šå†…éƒ¨ç»†èŠ‚

### 2. æ³¨æ„æ€§èƒ½
```tsx
// âŒ ä¸å¥½çš„å†™æ³•ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å‡½æ•°
useImperativeHandle(ref, () => ({
  doSomething: () => {
    // è¿™ä¸ªå‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»º
  }
}));

// âœ… å¥½çš„å†™æ³•ï¼šä½¿ç”¨ useCallback
const doSomething = useCallback(() => {
  // è¿™ä¸ªå‡½æ•°è¢«ç¼“å­˜äº†
}, []);

useImperativeHandle(ref, () => ({
  doSomething
}));
```

### 3. åšå¥½é”™è¯¯å¤„ç†
```tsx
// âœ… å¥½çš„å†™æ³•ï¼šå¢åŠ é”™è¯¯å¤„ç†
useImperativeHandle(ref, () => ({
  getData: async () => {
    try {
      const data = await fetchData();
      return data;
    } catch (error) {
      console.error('è·å–æ•°æ®å¤±è´¥:', error);
      return null;
    }
  }
}));
```

## å…­ã€å¸¸è§é—®é¢˜ â“

### 1. "ref.current ä¸º null"
```tsx
// âŒ å¯èƒ½å‡ºé”™
childRef.current.doSomething();

// âœ… å®‰å…¨çš„å†™æ³•
childRef.current?.doSomething();
```

### 2. "æ–¹æ³•æœªå®šä¹‰"
```tsx
// âŒ ç±»å‹ä¸åŒ¹é…
interface Handle {
  doA: () => void;
}

// ç»„ä»¶å®ç°æ—¶æ¼æ‰äº† doA æ–¹æ³•
useImperativeHandle(ref, () => ({
  doB: () => {}  // TypeScript ä¼šæŠ¥é”™
}));

// âœ… æ­£ç¡®å®ç°æ¥å£
useImperativeHandle(ref, () => ({
  doA: () => {}  // å®ç°äº†æ¥å£å®šä¹‰çš„æ–¹æ³•
}));
```

## ä¸ƒã€å®æˆ˜æŠ€å·§ ğŸ› ï¸

### 1. è¡¨å•æ§åˆ¶
```tsx
// è‡ªå®šä¹‰è¡¨å•ç»„ä»¶
interface FormHandle {
  reset: () => void;
  validate: () => boolean;
  submit: () => Promise<void>;
}

const MyForm = forwardRef<FormHandle>((props, ref) => {
  useImperativeHandle(ref, () => ({
    reset: () => {
      // é‡ç½®æ‰€æœ‰å­—æ®µ
    },
    validate: () => {
      // éªŒè¯æ‰€æœ‰å­—æ®µ
      return true;
    },
    submit: async () => {
      // æäº¤è¡¨å•
    }
  }));
  
  return <form>...</form>;
});
```

### 2. åª’ä½“æ’­æ”¾å™¨
```tsx
interface PlayerHandle {
  play: () => void;
  pause: () => void;
  seekTo: (time: number) => void;
}

const VideoPlayer = forwardRef<PlayerHandle>((props, ref) => {
  const videoRef = useRef<HTMLVideoElement>(null);
  
  useImperativeHandle(ref, () => ({
    play: () => videoRef.current?.play(),
    pause: () => videoRef.current?.pause(),
    seekTo: (time) => {
      if (videoRef.current) {
        videoRef.current.currentTime = time;
      }
    }
  }));
  
  return <video ref={videoRef}>...</video>;
});
```

## å…«ã€å°è´´å£« ğŸ’

1. **å‘½åè§„èŒƒ**ï¼š
   - Handle æ¥å£ä»¥ "Handle" ç»“å°¾
   - æ–¹æ³•åç”¨åŠ¨è¯å¼€å¤´ï¼š`reset`ã€`validate`ã€`getData`

2. **ä»£ç ç»„ç»‡**ï¼š
   - æ¥å£å®šä¹‰æ”¾åœ¨ç»„ä»¶å¤–éƒ¨
   - ç›¸å…³çš„æ–¹æ³•æ”¾åœ¨ä¸€èµ·
   - å¤æ‚é€»è¾‘ç”¨ hooks æŠ½ç¦»

3. **è°ƒè¯•æŠ€å·§**ï¼š
   - ç»™æ–¹æ³•æ·»åŠ  console.log
   - ä½¿ç”¨ React DevTools æŸ¥çœ‹ ref
   - å†™å•å…ƒæµ‹è¯•éªŒè¯åŠŸèƒ½
