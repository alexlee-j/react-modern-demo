# useTheme Hook

`useTheme` Hook æä¾›äº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æ–¹å¼æ¥ç®¡ç†åº”ç”¨çš„ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ã€‚å®ƒæ”¯æŒæµ…è‰²ã€æ·±è‰²ä»¥åŠè·Ÿéšç³»ç»Ÿä¸»é¢˜ä¸‰ç§æ¨¡å¼ï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨æŒä¹…åŒ–ä¸»é¢˜è®¾ç½®ã€‚

## åŸºæœ¬ç”¨æ³•

```tsx
import { useTheme } from "@/hooks/use-theme";

const ThemeToggle = () => {
  const { theme, setTheme } = useTheme();

  return (
    <Switch
      checked={theme === "dark"}
      onCheckedChange={(checked) => setTheme(checked ? "dark" : "light")}
    />
  );
};
```

## API è¯´æ˜

### è¿”å›å€¼

- `theme`: å½“å‰ä¸»é¢˜ï¼Œå¯èƒ½çš„å€¼ä¸º "light" | "dark" | "system"
- `setTheme`: è®¾ç½®ä¸»é¢˜çš„å‡½æ•°ï¼Œæ¥å— "light" | "dark" | "system" ä½œä¸ºå‚æ•°

## ç‰¹æ€§

- ğŸŒ“ æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜åˆ‡æ¢
- ğŸ”„ æ”¯æŒè·Ÿéšç³»ç»Ÿä¸»é¢˜
- ğŸ’¾ è‡ªåŠ¨æŒä¹…åŒ–ä¸»é¢˜è®¾ç½®
- ğŸ¨ ä½¿ç”¨ CSS å˜é‡ç®¡ç†ä¸»é¢˜é¢œè‰²

## React 19 æ–°ç‰¹æ€§é›†æˆ

### 1. use Hook æ”¯æŒ

åœ¨ React 19 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°çš„ `use` Hook æ¥ä¼˜åŒ–ä¸»é¢˜çŠ¶æ€çš„è·å–ï¼š

```tsx
import { use } from 'react';

const ThemeAwareComponent = () => {
  const theme = use(ThemeContext);
  return <div>å½“å‰ä¸»é¢˜ï¼š{theme}</div>;
};
```

### 2. è‡ªåŠ¨æ‰¹å¤„ç†ä¼˜åŒ–

React 19 çš„è‡ªåŠ¨æ‰¹å¤„ç†ç‰¹æ€§å¯ä»¥ä¼˜åŒ–ä¸»é¢˜åˆ‡æ¢æ—¶çš„æ€§èƒ½ï¼š

```tsx
const ThemeController = () => {
  const { setTheme } = useTheme();

  const handleThemeChange = () => {
    // React 19 ä¼šè‡ªåŠ¨æ‰¹å¤„ç†è¿™äº›æ›´æ–°
    setTheme('dark');
    updateThemeRelatedState();
    triggerThemeTransition();
  };
};
```

### 3. å¹¶å‘æ¸²æŸ“æ”¯æŒ

åˆ©ç”¨ React 19 çš„å¹¶å‘ç‰¹æ€§å¤„ç†ä¸»é¢˜åˆ‡æ¢ï¼š

```tsx
import { startTransition } from 'react';

const ThemeSwitch = () => {
  const { setTheme } = useTheme();

  const handleThemeToggle = () => {
    startTransition(() => {
      setTheme('dark');
    });
  };
};
```

## æœåŠ¡ç«¯ç»„ä»¶é›†æˆ

### 1. æœåŠ¡ç«¯ç»„ä»¶ä¸­çš„ä¸»é¢˜å¤„ç†

```tsx
async function ThemeAwareServerComponent() {
  // åœ¨æœåŠ¡ç«¯è·å–é»˜è®¤ä¸»é¢˜
  const defaultTheme = await getDefaultTheme();
  
  return (
    <ThemeProvider defaultTheme={defaultTheme}>
      <ClientThemeControls />
    </ThemeProvider>
  );
}
```

### 2. å®¢æˆ·ç«¯ç»„ä»¶ä¸æœåŠ¡ç«¯ç»„ä»¶ååŒ

```tsx
'use client';

const ClientThemeControls = () => {
  const { theme, setTheme } = useTheme();
  return <ThemeToggle />;
};
```

## æ€§èƒ½ä¼˜åŒ–

### 1. ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»

```tsx
const ThemeTransition = () => {
  const { theme } = useTheme();

  return (
    <div className="theme-transition" style={{
      transition: 'background-color 0.3s ease',
    }}>
      {/* å†…å®¹ */}
    </div>
  );
};
```

### 2. é€‰æ‹©æ€§æ¸²æŸ“

```tsx
import { memo } from 'react';

const ThemeAwareComponent = memo(({ theme }) => {
  return <div className={theme}>ä¸»é¢˜æ„ŸçŸ¥ç»„ä»¶</div>;
});
```

### 3. çŠ¶æ€åˆ†å‰²

```tsx
const ThemeProvider = ({ children }) => {
  const [themeState, setThemeState] = useState({
    current: 'light',
    previous: null,
  });

  // åˆ†ç¦»ä¸»é¢˜åˆ‡æ¢é€»è¾‘
  const handleThemeChange = useCallback((newTheme) => {
    setThemeState(prev => ({
      current: newTheme,
      previous: prev.current,
    }));
  }, []);
};
```

## æœ€ä½³å®è·µ

1. **ä¸»é¢˜åˆ‡æ¢**
   ```tsx
   const { theme, setTheme } = useTheme();
   
   // åˆ‡æ¢åˆ°æ·±è‰²ä¸»é¢˜
   setTheme("dark");
   
   // åˆ‡æ¢åˆ°æµ…è‰²ä¸»é¢˜
   setTheme("light");
   
   // è·Ÿéšç³»ç»Ÿä¸»é¢˜
   setTheme("system");
   ```

2. **ä¸»é¢˜çŠ¶æ€åˆ¤æ–­**
   ```tsx
   const { theme } = useTheme();
   
   // åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºæ·±è‰²ä¸»é¢˜
   const isDarkTheme = theme === "dark";
   ```

3. **ç³»ç»Ÿä¸»é¢˜åŒæ­¥**
   ```tsx
   const { theme } = useTheme();
   
   // è·å–ç³»ç»Ÿä¸»é¢˜
   const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches
     ? "dark"
     : "light";
   ```

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿åœ¨åº”ç”¨æ ¹ç»„ä»¶ä¸­åŒ…è£¹ ThemeProvider
2. é¿å…é¢‘ç¹åˆ‡æ¢ä¸»é¢˜ï¼Œå¯èƒ½å½±å“æ€§èƒ½
3. è€ƒè™‘ä¸»é¢˜åˆ‡æ¢æ—¶çš„è¿‡æ¸¡æ•ˆæœ
4. ä½¿ç”¨ CSS å˜é‡ç®¡ç†ä¸»é¢˜ç›¸å…³çš„æ ·å¼
5. åˆç†ä½¿ç”¨ React 19 çš„æ–°ç‰¹æ€§ä¼˜åŒ–æ€§èƒ½
6. æ³¨æ„æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶çš„èŒè´£åˆ†ç¦»

## ç›¸å…³èµ„æº

- [æºä»£ç å®ç°](/src/hooks/use-theme.tsx)
- [ç¤ºä¾‹ä»£ç ](/src/app/lab/[exampleId]/demo/use-theme.tsx)