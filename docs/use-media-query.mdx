---
title: useMediaQuery
description: 响应式设计和媒体查询的最佳实践
---

# useMediaQuery Hook

`useMediaQuery` 是一个用于响应式设计的自定义 Hook，它能够帮助我们监听和响应媒体查询的变化，使组件能够适应不同的屏幕尺寸和设备特性。

## 基础用法

```tsx
import { useMediaQuery } from '@/hooks/use-media-query';

function ResponsiveComponent() {
  const isMobile = useMediaQuery('(max-width: 768px)');
  const isTablet = useMediaQuery('(min-width: 769px) and (max-width: 1024px)');
  const isDesktop = useMediaQuery('(min-width: 1025px)');

  return (
    <div>
      {isMobile && <div>移动端布局</div>}
      {isTablet && <div>平板布局</div>}
      {isDesktop && <div>桌面布局</div>}
    </div>
  );
}
```

## API 说明

### 参数

```typescript
interface UseMediaQueryOptions {
  debounce?: boolean;      // 是否启用防抖
  debounceDelay?: number;  // 防抖延迟时间（毫秒）
}

function useMediaQuery(query: string, options?: UseMediaQueryOptions): boolean;
```

- `query`: 媒体查询字符串，遵循标准的 CSS 媒体查询语法
- `options`: 可选配置项
  - `debounce`: 是否启用防抖优化
  - `debounceDelay`: 防抖延迟时间，默认 300ms

### 返回值

- `boolean`: 当前媒体查询是否匹配

## 高级用法

### 1. 暗色模式检测

```tsx
function DarkModeExample() {
  const prefersDark = useMediaQuery('(prefers-color-scheme: dark)');

  return (
    <div className={prefersDark ? 'dark' : 'light'}>
      当前主题：{prefersDark ? '暗色' : '亮色'}
    </div>
  );
}
```

### 2. 设备特性检测

```tsx
function DeviceFeatures() {
  const isHoverDevice = useMediaQuery('(hover: hover)');
  const prefersReducedMotion = useMediaQuery('(prefers-reduced-motion)');

  return (
    <div>
      <p>设备支持悬停: {isHoverDevice ? '是' : '否'}</p>
      <p>用户偏好减少动画: {prefersReducedMotion ? '是' : '否'}</p>
    </div>
  );
}
```

### 3. 性能优化示例

```tsx
function OptimizedList() {
  const isMobile = useMediaQuery('(max-width: 768px)', {
    debounce: true,
    debounceDelay: 500
  });

  return (
    <div>
      {isMobile ? (
        <SimpleList items={items} />
      ) : (
        <ComplexList items={items} />
      )}
    </div>
  );
}
```

## 最佳实践

### 常用断点

```tsx
const breakpoints = {
  mobile: '(max-width: 768px)',
  tablet: '(min-width: 769px) and (max-width: 1024px)',
  desktop: '(min-width: 1025px)',
  dark: '(prefers-color-scheme: dark)',
  light: '(prefers-color-scheme: light)',
  hover: '(hover: hover)',
  touch: '(hover: none) and (pointer: coarse)',
  highDPI: '(min-resolution: 2dppx)'
};
```

### 性能优化建议

1. **合理使用防抖**
   - 对于频繁变化的查询（如调整窗口大小），建议启用防抖
   - 对于不频繁的变化（如暗色模式切换），可以不使用防抖

2. **避免过多的媒体查询**
   - 将常用的媒体查询抽取为常量
   - 考虑使用 CSS 媒体查询处理简单的样式变化

3. **SSR 注意事项**
   - 服务端渲染时默认返回 `false`
   - 确保组件能够优雅降级

### 常见用例

1. **响应式布局**
   - 根据屏幕尺寸调整组件布局
   - 动态加载不同分辨率的图片

2. **用户体验优化**
   - 检测设备能力，提供最适合的交互方式
   - 根据用户偏好调整动画效果

3. **性能优化**
   - 在移动端使用更简单的组件版本
   - 根据设备性能调整功能复杂度

## 注意事项

1. 避免在渲染过程中频繁切换媒体查询
2. 考虑使用 CSS 媒体查询处理简单的样式变化
3. 确保提供合适的默认值和降级方案
4. 在服务端渲染时要特别注意处理

## 相关资源

- [MDN Media Queries](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Media_Queries)
- [响应式设计最佳实践](https://web.dev/responsive-web-design-basics/)
- [使用 CSS 媒体查询优化移动体验](https://web.dev/optimize-for-mobile/)